# DevTeam Notifier Bot

Telegram-–±–æ—Ç –¥–ª—è –∫–æ–º–∞–Ω–¥ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤: –ø—Ä–∏–Ω–∏–º–∞–µ—Ç GitHub webhooks –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —á–∞—Ç—ã.

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:

- —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ **Pull Request**, **push** –∏ **GitHub Actions (workflow_run)**;
- **–ø–æ–¥–ø–∏—Å–∫–∏ —á–∞—Ç–æ–≤ –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏** —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –≤–µ—Ç–∫–∞–º;
- **–∫—Ä–∞—Å–∏–≤—ã–π UX –≤ Telegram**: –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∏ –∏ —Ç—Ä–µ–¥—ã –ø–æ PR;
- –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤ –ë–î –∏ –∫–æ–º–∞–Ω–¥—É **`/daily_digest`** –¥–ª—è —Å—É—Ç–æ—á–Ω–æ–π —Å–≤–æ–¥–∫–∏.

---

## –°—Ç–µ–∫

- Python, FastAPI
- aiogram (Telegram Bot API)
- SQLAlchemy + SQLite (dev)
- Uvicorn
- (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ngrok / –ª—é–±–æ–π —Ç—É–Ω–Ω–µ–ª—å –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ GitHub Webhook

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üîî GitHub —Å–æ–±—ã—Ç–∏—è ‚Üí Telegram

–ë–æ—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç GitHub webhooks –ø–æ –∞–¥—Ä–µ—Å—É:

```text
POST /webhook/github
```

–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è:

- `pull_request` ‚Äî –æ—Ç–∫—Ä—ã—Ç–∏–µ / –ø–µ—Ä–µ–æ—Ç–∫—Ä—ã—Ç–∏–µ / –∑–∞–∫—Ä—ã—Ç–∏–µ / merge;
- `push` ‚Äî –ø—É—à–∏ –≤ –≤–µ—Ç–∫–∏;
- `workflow_run` ‚Äî —Å—Ç–∞—Ç—É—Å—ã GitHub Actions.

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–±—ã—Ç–∏—è:

- —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ñ–æ—Ä–º–ª–µ–Ω –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —á—Ç–µ–Ω–∏—è (—Ä–µ–ø–æ, –≤–µ—Ç–∫–∞, –∞–≤—Ç–æ—Ä, –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ);
- –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è **inline-–∫–Ω–æ–ø–∫–∏**:
  - PR: `üîç –û—Ç–∫—Ä—ã—Ç—å PR`, `üì¶ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π`;
  - push: `üì¶ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π`;
  - CI: `üöÄ –û—Ç–∫—Ä—ã—Ç—å run`, `üì¶ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π`.

### üåø –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤–µ—Ç–∫–∞–º

–ü–æ–¥–ø–∏—Å–∫–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ ¬´—á–∞—Ç ‚Üî —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π¬ª –∏ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ñ–∏–ª—å—Ç—Ä –≤–µ—Ç–æ–∫:

```text
/set_branches owner/repo main,develop,release/*
```

- `main,develop` ‚Äî —Ç–æ—á–Ω—ã–µ –∏–º–µ–Ω–∞ –≤–µ—Ç–æ–∫;
- `release/*` ‚Äî —à–∞–±–ª–æ–Ω: –≤—Å–µ –≤–µ—Ç–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å `release/`.

–ï—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä –Ω–µ –∑–∞–¥–∞–Ω ‚Äî —á–∞—Ç –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –ø–æ –≤—Å–µ–º –≤–µ—Ç–∫–∞–º.

### üßµ –¢—Ä–µ–¥—ã –¥–ª—è Pull Request

–î–ª—è –∫–∞–∂–¥–æ–≥–æ PR –±–æ—Ç —Å–æ–∑–¥–∞—ë—Ç ¬´root-—Å–æ–æ–±—â–µ–Ω–∏–µ¬ª –∏ —Ö—Ä–∞–Ω–∏—Ç –µ–≥–æ message_id –≤ —Ç–∞–±–ª–∏—Ü–µ `PRThread`.

–î–∞–ª—å—à–µ:

- —Å–æ–±—ã—Ç–∏—è `reopened` / `closed` / `merged` –ø–æ —Ç–æ–º—É –∂–µ PR –ø—Ä–∏—Ö–æ–¥—è—Ç –∫–∞–∫ **reply** –Ω–∞ –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ;
- –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Telegram –≤—Å—ë, —á—Ç–æ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ PR, —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –≤ –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–π —Ç—Ä–µ–¥.

–≠—Ç–æ —Å–∏–ª—å–Ω–æ —É–ø—Ä–æ—â–∞–µ—Ç –∂–∏–∑–Ω—å –≤ –∂–∏–≤—ã—Ö –∫–æ–º–∞–Ω–¥–∞—Ö, –≥–¥–µ PR-–æ–≤ –º–Ω–æ–≥–æ.

### üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ daily digest

–í—Å–µ —Å–æ–±—ã—Ç–∏—è, –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –≤ —á–∞—Ç, –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `EventLog`:

- —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è (`pull_request`, `push`, `workflow_run`);
- –ø–æ–¥—Ç–∏–ø/—Å—Ç–∞—Ç—É—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `opened`, `merged`, `success`, `failure`);
- –≤—Ä–µ–º—è;
- —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π;
- –∫—Ä–∞—Ç–∫–∏–π —Ç–µ–∫—Å—Ç-summary.

–ö–æ–º–∞–Ω–¥–∞:

```text
/daily_digest
```

–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–≤–æ–¥–∫—É –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞: —Å–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π (PR, push, CI) –ø–æ —ç—Ç–æ–º—É —á–∞—Ç—É.

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∞—Ä–≥—É–º–µ–Ω—Ç:

```text
/daily_digest 48      # –∑–∞ 48 —á–∞—Å–æ–≤
/daily_digest 7d      # –∑–∞ 7 –¥–Ω–µ–π
```

---

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

–í —á–∞—Ç–µ —Å –±–æ—Ç–æ–º:

- `/start` ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, –ø–æ–∫–∞–∑ `chat_id` –∏ –∫—Ä–∞—Ç–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞.
- `/ping` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –±–æ—Ç –∂–∏–≤ (`pong`).
- `/link_repo owner/repo` ‚Äî –ø–æ–¥–ø–∏—Å–∞—Ç—å —á–∞—Ç –Ω–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
- `/subscriptions` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ —á–∞—Ç–∞ + —Ñ–∏–ª—å—Ç—Ä—ã –≤–µ—Ç–æ–∫.
- `/unlink_repo owner/repo` ‚Äî –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.
- `/set_branches owner/repo branches` ‚Äî –∑–∞–¥–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä –≤–µ—Ç–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `main,develop,release/*`).
- `/daily_digest [N|Nd]` ‚Äî –¥–∞–π–¥–∂–µ—Å—Ç —Å–æ–±—ã—Ç–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —á–∞—Å–æ–≤ –∏–ª–∏ N –¥–Ω–µ–π.

---

## –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ

1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –ø–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞:

   ```bash
   git clone https://github.com/<your-username>/DevTeam-Notifier-Bot.git
   cd DevTeam-Notifier-Bot
   ```

2. –°–æ–∑–¥–∞—Ç—å –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:

   ```bash
   python -m venv .venv
   source .venv/bin/activate  # Linux/macOS
   # .venv\Scripts\activate   # Windows
   ```

3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

   ```bash
   pip install -r requirements.txt
   ```

4. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `.env`:

   ```env
   BOT_TOKEN=—Ç–≤–æ–π_telegram_bot_token
   APP_HOST=0.0.0.0
   APP_PORT=8000

   # –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏ –ø–æ–¥–ø–∏—Å—å –º–æ–∂–Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å:
   GITHUB_WEBHOOK_SECRET=
   DATABASE_URL=sqlite:///./devteam_notifier.db
   ```

5. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–±–æ—Ç + API):

   ```bash
   python -m app.main
   ```

6. –í Telegram:

   - –Ω–∞–ø–∏—Å–∞—Ç—å –±–æ—Ç—É `/start`;
   - –ø–æ–¥–ø–∏—Å–∞—Ç—å —á–∞—Ç –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

     ```text
     /link_repo example/repo
     /set_branches example/repo main,develop
     ```

7. –ü–æ—Ç–µ—Å—Ç–∏—Ç—å webhooks –ª–æ–∫–∞–ª—å–Ω–æ (curl):

   ```bash
   # PR opened
   curl -X POST http://localhost:8000/webhook/github      -H "Content-Type: application/json"      -H "X-GitHub-Event: pull_request"      -d '{
       "action": "opened",
       "pull_request": {
         "number": 101,
         "title": "Test threaded PR",
         "html_url": "https://github.com/example/repo/pull/101",
         "user": { "login": "thread-tester" },
         "base": { "ref": "main" },
         "head": { "ref": "feature/thread-test" },
         "merged": false
       },
       "repository": { "full_name": "example/repo" }
     }'
   ```

   –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –º–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å push –∏ CI (workflow_run) —Å–æ–±—ã—Ç–∏—è.

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º GitHub (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ GitHub Webhook:

1. –ü–æ–¥–Ω—è—Ç—å —Ç—É–Ω–Ω–µ–ª—å –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ngrok http 8000`).
2. –í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ GitHub ‚Üí Settings ‚Üí Webhooks —Å–æ–∑–¥–∞—Ç—å webhook:
   - Payload URL: `https://<ngrok-url>/webhook/github`
   - Content type: `application/json`
   - Secret: —Ç–æ–∫–µ–Ω, —Å–æ–≤–ø–∞–¥–∞—é—â–∏–π —Å `GITHUB_WEBHOOK_SECRET` –≤ `.env`
   - Events: `Pull requests`, `Pushes`, `Workflow runs`.
3. –û—Ç–∫—Ä—ã–≤–∞—Ç—å PR / –ø—É—à–∏—Ç—å / –∑–∞–ø—É—Å–∫–∞—Ç—å Actions –∏ —Å–º–æ—Ç—Ä–µ—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **FastAPI**:
  - `/webhook/github` ‚Äî –ø—Ä–∏—ë–º GitHub —Å–æ–±—ã—Ç–∏–π;
  - `/health` ‚Äî healthcheck.
- **Telegram-–±–æ—Ç –Ω–∞ aiogram**:
  - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ `/start`, `/link_repo`, `/subscriptions`, `/set_branches`, `/daily_digest` –∏ –¥—Ä.
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (SQLite/SQLAlchemy)**:
  - `Chat` ‚Äî Telegram-—á–∞—Ç;
  - `Repo` ‚Äî —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (GitHub –∏ –≤ –±—É–¥—É—â–µ–º –¥—Ä—É–≥–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã);
  - `Subscription` ‚Äî –ø–æ–¥–ø–∏—Å–∫–∞ —á–∞—Ç ‚Üî —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π + —Ñ–∏–ª—å—Ç—Ä—ã;
  - `PRThread` ‚Äî –ø—Ä–∏–≤—è–∑–∫–∞ PR –∫ –∫–æ—Ä–Ω–µ–≤–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é –≤ —á–∞—Ç–µ (–¥–ª—è —Ç—Ä–µ–¥–æ–≤);
  - `EventLog` ‚Äî –ª–æ–≥ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.

–î–∞–ª—å–Ω–µ–π—à–∏–µ –ø–ª–∞–Ω—ã: –∞–≤—Ç–æ-–¥–∞–π–¥–∂–µ—Å—Ç—ã –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (APSheduler), —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (GitLab, Jira –∏ —Ç.–ø.).
